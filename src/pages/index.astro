---
// src/pages/index.astro
// 孤星行动复古未来主义版 v8 (Final Fix)
// 修复：
// 1. 链接增加尾部斜杠适配 trailingSlash: 'always'
// 2. 动画速度大幅减慢
// 3. 底部文字增加CRT扫描特效

const rawBase = import.meta.env.BASE_URL ?? "/";
const base = rawBase.endsWith("/") ? rawBase.slice(0, -1) : rawBase;
// 适配 trailingSlash: "always"，强制加上末尾斜杠
const homePath = `${base}/home/`;
---

<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LONE TRAIL // SYSTEM LAUNCH</title>
    
    <!-- 引入 Noto Sans SC 和其他字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Barlow+Condensed:wght@400;600;800&family=Noto+Sans+SC:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="theme-transition min-h-screen flex flex-col relative overflow-x-hidden selection:bg-[var(--retro-red)] selection:text-[#f8f6e7]">

    <!-- 1. 视觉特效层 -->
    <div class="fixed inset-0 pointer-events-none z-50 opacity-[0.12] mix-blend-multiply dark:mix-blend-overlay bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"></div>
    <div class="scanlines fixed inset-0 pointer-events-none z-40 opacity-0 dark:opacity-30 transition-opacity duration-500"></div>

    <!-- 2. 背景层 -->
    <div class="fixed inset-0 z-0 bg-[var(--bg-paper)] transition-colors duration-500"></div>
    <canvas id="radarCanvas" class="fixed top-0 left-0 w-full h-full z-0 pointer-events-none mix-blend-multiply dark:mix-blend-screen opacity-60 dark:opacity-100"></canvas>

    <!-- 3. 顶部导航 -->
    <header class="fixed top-0 left-0 right-0 z-40 h-24 flex items-center justify-between px-6 lg:px-12 transition-all duration-500 border-b-4 border-transparent">
        <div class="flex items-center gap-6">
             <div class="w-2 h-2 bg-[var(--retro-green)] rounded-full animate-pulse"></div>
             <span class="text-[var(--text-sub)] font-mono text-xs tracking-widest opacity-50">SYSTEM_READY</span>
        </div>
        <div class="flex items-center gap-8">
            <div id="clock" class="hidden sm:block text-[var(--retro-red)] font-mono font-bold text-xl tracking-widest chromatic-text transition-colors">00:00:00</div>
            <button id="themeToggle" class="relative w-16 h-8 bg-[var(--text-main)] rounded-full border-2 border-[var(--text-main)] cursor-pointer group transition-colors overflow-hidden">
                <div class="absolute inset-0 bg-[var(--retro-yellow)] opacity-0 dark:opacity-20 transition-opacity"></div>
                <div class="absolute top-0.5 left-0.5 w-6 h-6 bg-[var(--bg-paper)] rounded-full shadow-md transform transition-transform duration-300 dark:translate-x-8 flex items-center justify-center">
                    <i data-lucide="sun" class="w-3 h-3 text-[var(--text-main)] dark:hidden"></i>
                    <i data-lucide="moon" class="w-3 h-3 text-[var(--text-main)] hidden dark:block"></i>
                </div>
            </button>
        </div>
    </header>

    <!-- 4. 主内容区域 -->
    <main class="flex-grow flex flex-col justify-center items-center relative z-10 w-full px-4 pt-20 pb-20">
        <div class="absolute top-0 right-10 h-full w-20 hidden lg:flex flex-col opacity-10 pointer-events-none mix-blend-multiply dark:mix-blend-overlay">
            <div class="w-full h-full bg-[var(--retro-green)]"></div>
            <div class="w-full h-full bg-[var(--retro-yellow)]"></div>
            <div class="w-full h-full bg-[var(--retro-red)]"></div>
        </div>

        <div class="relative z-10 max-w-6xl w-full grid lg:grid-cols-12 gap-12 items-center">
            <div class="lg:col-span-7 space-y-8">
                <div class="flex items-center gap-4 text-[var(--retro-red)] font-mono font-bold text-lg">
                    <span class="border-b-2 border-[var(--retro-red)] pb-1">CW-10</span>
                    <span class="animate-pulse">///</span>
                    <span>ACCESS GRANTED</span>
                </div>

                <!-- 标题区 -->
                <div class="flex gap-4 md:gap-8 items-stretch select-none">
                    <div class="flex flex-col leading-[0.85] font-black uppercase text-[var(--text-main)] tracking-tighter chromatic-text">
                        <span class="text-7xl md:text-9xl">LONE</span>
                        <span class="text-7xl md:text-9xl text-transparent bg-clip-text bg-gradient-to-r from-[var(--retro-green)] via-[var(--retro-yellow)] to-[var(--retro-red)]" style="-webkit-text-stroke: 2px var(--text-main); text-shadow: 4px 4px 0px var(--bg-paper);">TRAIL</span>
                    </div>
                    <div class="flex flex-col justify-between py-1 md:py-2 font-noto font-black text-[var(--text-main)] leading-none chromatic-text opacity-90">
                        <span class="text-6xl md:text-8xl text-left">孤</span>
                        <span class="text-6xl md:text-8xl text-left">星</span>
                    </div>
                </div>

                <!-- 详情区 -->
                <div class="flex flex-col md:flex-row gap-8 items-start border-t-4 border-[var(--text-main)] pt-6">
                    <div class="flex flex-col shrink-0 font-noto text-[var(--text-main)] leading-tight uppercase tracking-wide border-r-0 md:border-r-4 border-[var(--text-main)] md:pr-8">
                        <span class="text-xl font-normal">Rhine Lab</span>
                        <span class="text-2xl font-black">Pioneer Project</span>
                    </div>
                    <div class="space-y-2 max-w-md">
                        <p class="text-[var(--text-main)] font-mono font-bold text-sm leading-relaxed">
                            "Before us lies a sea of stars.
                        </p>
                        <p class="text-[var(--text-main)] font-noto font-bold text-sm leading-relaxed">
                            在我们面前，是星辰大海。"
                        </p>
                        <p class="text-[var(--text-sub)] font-sans text-xs leading-relaxed text-justify mt-4 opacity-80">
                            高度修正完成。重力井参数稳定。保存者计划（Project ARC）数据已归档。请进行身份验证以接入终端。
                        </p>
                    </div>
                </div>

                <!-- 按钮 -->
                <div class="pt-4">
                    <a href={homePath} class="group relative inline-flex items-center justify-center px-10 py-5 overflow-hidden font-mono font-bold tracking-widest text-[var(--text-main)] uppercase transition-all duration-300 bg-transparent border-2 border-[var(--text-main)] hover:bg-[var(--text-main)] hover:text-[var(--bg-paper)] focus:outline-none cursor-pointer text-decoration-none">
                        <span class="absolute top-0 left-0 w-3 h-3 border-t-4 border-l-4 border-[var(--retro-red)] transition-all duration-300 group-hover:w-full group-hover:h-full group-hover:border-[var(--retro-yellow)] group-hover:opacity-20"></span>
                        <span class="absolute bottom-0 right-0 w-3 h-3 border-b-4 border-r-4 border-[var(--retro-green)] transition-all duration-300 group-hover:w-full group-hover:h-full group-hover:border-[var(--retro-yellow)] group-hover:opacity-20"></span>
                        <span class="absolute inset-0 w-full h-full opacity-0 group-hover:opacity-30 bg-[repeating-linear-gradient(45deg,transparent,transparent_2px,var(--text-main)_2px,var(--text-main)_4px)] transition-opacity duration-300"></span>
                        <span class="relative flex items-center gap-3 z-10">
                            <i data-lucide="power" class="w-5 h-5"></i>
                            <span class="text-xl">INITIATE LAUNCH</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                        </span>
                    </a>
                </div>
            </div>

            <!-- 右侧数据 -->
            <div class="lg:col-span-5 relative h-[400px] flex justify-center items-center pointer-events-none">
                <div class="relative z-10 bg-[var(--bg-paper)] border-2 border-[var(--text-main)] p-6 chromatic-box shadow-2xl backdrop-blur-sm bg-opacity-80">
                    <div class="flex justify-between items-end border-b-2 border-[var(--text-main)] pb-2 mb-4">
                        <span class="font-mono font-bold text-[var(--text-main)]">SYS_STATUS</span>
                        <div class="flex gap-1">
                            <div class="w-2 h-2 bg-[var(--retro-green)] animate-pulse"></div>
                            <div class="w-2 h-2 bg-[var(--retro-yellow)]"></div>
                            <div class="w-2 h-2 bg-[var(--retro-red)]"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-8 text-center">
                        <div>
                            <div class="text-[10px] font-mono text-[var(--text-sub)]">ALTITUDE</div>
                            <div class="text-3xl font-impact text-[var(--text-main)] tabular-nums">29,301</div>
                        </div>
                        <div>
                            <div class="text-[10px] font-mono text-[var(--text-sub)]">VELOCITY</div>
                            <div class="text-3xl font-impact text-[var(--text-main)] tabular-nums">M 3.5</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部状态栏 -->
    <footer class="fixed bottom-0 w-full z-40 bg-[var(--bg-paper)] border-t-2 border-[var(--text-main)] py-3 px-6 flex justify-between items-center text-xs font-mono font-bold uppercase tracking-wider transition-colors duration-500">
        <div class="flex items-center gap-4 text-[var(--text-main)] relative crt-scan-text px-2">
            <span class="w-3 h-3 bg-[var(--retro-green)] rounded-full animate-pulse shadow-[0_0_8px_var(--retro-green)]"></span>
            <span>System Online // Satellite Link Active</span>
        </div>
        <div class="flex gap-1">
            <span class="bg-[var(--retro-green)] px-2 py-0.5 text-[var(--text-main)]">NET</span>
            <span class="bg-[var(--retro-yellow)] px-2 py-0.5 text-[var(--text-main)]">SEC</span>
            <span class="bg-[var(--retro-red)] px-2 py-0.5 text-[#f8f6e7]">LOG</span>
        </div>
    </footer>

    <style is:global>
        :root {
            /* 白天模式 */
            --bg-paper: #f8f6e7;
            --text-main: #1a1a1a;
            --text-sub: #5c5c5c;
            --retro-red: #9a2d28;
            --retro-yellow: #eca93b;
            --retro-green: #87c1af;
        }

        html.dark {
            /* 夜间模式 */
            --bg-paper: #0a0b10;
            --text-main: #e2f0ff;
            --text-sub: #87c1af;
            --retro-red: #ff4d4d;
            --retro-yellow: #ffc107;
            --retro-green: #87c1af;
        }

        .font-condensed { font-family: 'Barlow Condensed', sans-serif; }
        .font-impact { font-family: 'Anton', sans-serif; }
        .font-mono { font-family: 'Share Tech Mono', monospace; }
        .font-noto { font-family: 'Noto Sans SC', sans-serif; }

        .chromatic-text { text-shadow: -1px -1px 0 rgba(154, 45, 40, 0.2), 1px 1px 0 rgba(135, 193, 175, 0.2); }
        .chromatic-box { box-shadow: -3px 3px 0 rgba(154, 45, 40, 0.3), 3px -3px 0 rgba(135, 193, 175, 0.3); }
        html.dark .chromatic-text { text-shadow: -2px 0 0 rgba(255, 0, 0, 0.5), 2px 0 0 rgba(0, 255, 255, 0.5); }

        .scanlines {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            animation: scanlineMove 10s linear infinite;
        }
        @keyframes scanlineMove { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }

        /* 文字扫描动画 (减慢到8s) */
        .crt-scan-text { position: relative; overflow: hidden; }
        .crt-scan-text::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent 50%, rgba(135, 193, 175, 0.2) 51%, transparent 52%);
            background-size: 100% 8px; animation: text-scan 8s linear infinite; pointer-events: none;
        }
        @keyframes text-scan { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }
        .theme-transition { transition: background-color 0.5s ease, color 0.5s ease; }
    </style>

    <script>
        // @ts-ignore
        if (typeof lucide !== 'undefined') { lucide.createIcons(); }

        const themeToggleBtn = document.getElementById('themeToggle');
        const html = document.documentElement;
        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (savedTheme === 'dark' || (!savedTheme && systemDark)) html.classList.add('dark');
        else html.classList.remove('dark');

        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', () => {
                const isDark = html.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });
        }

        setInterval(() => {
            const el = document.getElementById('clock');
            if (el) el.innerText = new Date().toLocaleTimeString('en-GB', { hour12: false });
        }, 1000);

        const canvas = document.getElementById('radarCanvas');
        if (canvas) {
            // @ts-ignore
            const ctx = canvas.getContext('2d');
            let w: number, h: number;
            const resize = () => { w = window.innerWidth; h = window.innerHeight; 
            // @ts-ignore
            canvas.width = w; canvas.height = h; };
            window.addEventListener('resize', resize);
            resize();

            const getVarColor = (name: string) => getComputedStyle(document.documentElement).getPropertyValue(name).trim();

            const satellites = [
                { r: 0.25, angle: 0, speed: 0.0004, colorName: '--retro-red', size: 4 },
                { r: 0.35, angle: 2, speed: -0.0003, colorName: '--retro-yellow', size: 3 },
                { r: 0.45, angle: 4, speed: 0.0002, colorName: '--retro-green', size: 5 }
            ];

            let radarRotation = 0;
            function animate() {
                ctx.clearRect(0, 0, w, h);
                const cx = w * 0.75; const cy = h * 0.5; const minDim = Math.min(w, h);
                const lineColor = html.classList.contains('dark') ? 'rgba(226, 240, 255, 0.15)' : 'rgba(26, 26, 26, 0.1)';
                
                ctx.strokeStyle = lineColor; ctx.lineWidth = 1;
                for(let i=1; i<=5; i++) { ctx.beginPath(); ctx.arc(cx, cy, minDim * 0.1 * i, 0, Math.PI * 2); ctx.stroke(); }

                radarRotation += 0.002; // 慢速雷达
                const scanRadius = minDim * 0.5;
                ctx.save(); ctx.translate(cx, cy); ctx.rotate(radarRotation);
                ctx.beginPath(); ctx.moveTo(0, 0); ctx.arc(0, 0, scanRadius, 0, 0.5);
                ctx.fillStyle = html.classList.contains('dark') ? 'rgba(135, 193, 175, 0.1)' : 'rgba(26, 26, 26, 0.05)';
                ctx.fill();
                ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(scanRadius, 0);
                ctx.strokeStyle = html.classList.contains('dark') ? 'rgba(135, 193, 175, 0.5)' : 'rgba(26, 26, 26, 0.2)';
                ctx.stroke();
                ctx.restore();

                satellites.forEach(sat => {
                    const radius = minDim * sat.r; sat.angle += sat.speed;
                    const color = getVarColor(sat.colorName);
                    const x = cx + Math.cos(sat.angle) * radius; const y = cy + Math.sin(sat.angle) * radius;

                    ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = 2;
                    ctx.globalAlpha = 0.3; ctx.arc(cx, cy, radius, sat.speed>0?sat.angle-0.5:sat.angle+0.5, sat.angle, sat.speed<0); ctx.stroke(); ctx.globalAlpha = 1;

                    ctx.beginPath(); ctx.fillStyle = color; ctx.arc(x, y, sat.size, 0, Math.PI*2); ctx.fill();
                });
                requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>